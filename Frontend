<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stellar Observatory | Professional Astronomy Platform</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Three.js Import Map -->
    <script type="importmap">
      {
        "imports": {
          "three": "https://cdn.jsdelivr.net/npm/three@0.161/build/three.module.js",
          "jsm/": "https://cdn.jsdelivr.net/npm/three@0.161/examples/jsm/"
        }
      }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&family=Space+Mono:wght@400;700&display=swap');
        
        :root {
            --bg-primary: #000000;
            --bg-secondary: #0a0a0a;
            --bg-tertiary: #141414;
            --text-primary: #ffffff;
            --text-secondary: #888888;
            --accent: #ffffff;
            --border: #1a1a1a;
            --glow: rgba(255, 255, 255, 0.1);
        }
        
        html {
            scroll-behavior: smooth;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow-x: hidden;
            line-height: 1.6;
        }
        
        /* Three.js Canvas */
        #three-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            z-index: -1; /* Changed to background */
        }
        
        .page-transition {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s ease, transform 0.5s ease;
        }
        
        .page-transition.active {
            opacity: 1;
            transform: translateY(0);
        }
        
        .mono-font {
            font-family: 'Space Mono', monospace;
        }
        
        .bg-grid {
            background-image: 
                linear-gradient(to right, rgba(255,255,255,0.05) 1px, transparent 1px),
                linear-gradient(to bottom, rgba(255,255,255,0.05) 1px, transparent 1px);
            background-size: 50px 50px;
        }
        
        .text-glow {
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-primary);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 0.5s ease;
        }
        
        .loading.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 2px solid var(--border);
            border-top-color: var(--text-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Earth background enhancement */
        .earth-bg {
            background-image: url('https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/planets/earth_atmos_2048.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            position: relative;
        }
        
        .earth-bg::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, transparent 0%, rgba(0,0,0,0.9) 70%);
        }

        /* AI Assistant Styles */
        #ai-assistant-toggle {
            position: fixed;
            bottom: 100px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
            z-index: 1000;
            transition: all 0.3s ease;
        }

        #ai-assistant-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 15px 30px rgba(102, 126, 234, 0.4);
        }

        #ai-assistant {
            position: fixed;
            bottom: 170px;
            right: 30px;
            width: 350px;
            height: 500px;
            background: rgba(10, 10, 10, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            display: none;
            flex-direction: column;
            z-index: 999;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            overflow: hidden;
        }

        .ai-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            text-align: center;
            color: white;
        }

        .ai-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .ai-message {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 14px;
            line-height: 1.4;
        }

        .ai-user {
            align-self: flex-end;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .ai-assistant {
            align-self: flex-start;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .ai-input-container {
            padding: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            gap: 10px;
        }

        .ai-input {
            flex: 1;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 25px;
            padding: 12px 20px;
            color: white;
            outline: none;
        }

        .ai-input:focus {
            border-color: #667eea;
        }

        .ai-send-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: white;
        }

        .ai-typing {
            display: none;
            align-items: center;
            gap: 5px;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            margin: 10px 20px;
            align-self: flex-start;
        }

        .ai-typing-dot {
            width: 8px;
            height: 8px;
            background: #667eea;
            border-radius: 50%;
            animation: typing 1.4s infinite ease-in-out;
        }

        .ai-typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .ai-typing-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes typing {
            0%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
        }

        /* Navigation Fix */
        .nav-link {
            transition: all 0.3s ease;
        }

        .nav-link.active {
            color: white;
            border-bottom: 2px solid white;
        }

        /* Risk Analyzer Styles */
        .risk-meter {
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .risk-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .risk-low { background: linear-gradient(90deg, #10b981, #34d399); }
        .risk-medium { background: linear-gradient(90deg, #f59e0b, #fbbf24); }
        .risk-high { background: linear-gradient(90deg, #ef4444, #f87171); }
        .risk-critical { background: linear-gradient(90deg, #7c2d12, #dc2626); }

        .risk-label {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .risk-score {
            font-size: 2.5rem;
            font-weight: 800;
            font-family: 'Space Mono', monospace;
        }

        .risk-factor {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 12px;
            margin: 8px 0;
            border-left: 4px solid transparent;
        }

        .risk-factor.critical { border-left-color: #ef4444; }
        .risk-factor.high { border-left-color: #f59e0b; }
        .risk-factor.medium { border-left-color: #3b82f6; }
        .risk-factor.low { border-left-color: #10b981; }
    </style>
</head>
<body class="bg-black text-white">
    <!-- Loading Screen -->
    <div class="loading" id="loading">
        <div class="loading-spinner"></div>
        <div class="text-gray-400 uppercase tracking-widest text-sm">LOADING STELLAR OBSERVATORY...</div>
    </div>

    <!-- AI Assistant -->
    <div id="ai-assistant-toggle">
        <i class="fas fa-robot text-2xl"></i>
    </div>

    <div id="ai-assistant">
        <div class="ai-header">
            <h3 class="font-bold text-lg">Cosmic AI Assistant</h3>
            <p class="text-sm opacity-90">Ask me about asteroids, space, or our observatory</p>
        </div>
        <div class="ai-messages" id="ai-messages">
            <div class="ai-message ai-assistant">
                ðŸ‘‹ Hello! I'm your Cosmic AI Assistant. I can help you with:
                â€¢ Asteroid information and tracking
                â€¢ Space research and data
                â€¢ Observatory features
                â€¢ Planetary defense
                What would you like to know?
            </div>
        </div>
        <div class="ai-typing" id="ai-typing">
            <div class="ai-typing-dot"></div>
            <div class="ai-typing-dot"></div>
            <div class="ai-typing-dot"></div>
        </div>
        <div class="ai-input-container">
            <input type="text" id="ai-input" class="ai-input" placeholder="Ask about asteroids, space, or research..." maxlength="500">
            <button id="ai-send" class="ai-send-btn">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>

    <!-- Three.js Canvas -->
    <canvas id="three-canvas"></canvas>

    <!-- Navigation -->
    <nav id="navbar" class="fixed top-0 left-0 right-0 py-6 px-8 lg:px-12 flex justify-between items-center bg-gradient-to-b from-black/90 to-transparent backdrop-blur-md border-b border-gray-800 z-50 transition-all duration-300">
        <div class="mono-font font-bold text-xl tracking-widest cursor-pointer" onclick="navigateTo('home')">STELLAR OBSERVATORY</div>
        
        <div class="menu-toggle lg:hidden flex flex-col gap-1 cursor-pointer" onclick="toggleMenu()">
            <span class="w-6 h-0.5 bg-white"></span>
            <span class="w-6 h-0.5 bg-white"></span>
            <span class="w-6 h-0.5 bg-white"></span>
        </div>
        
        <ul class="nav-links hidden lg:flex gap-10 list-none">
            <li><a href="#" class="nav-link text-white uppercase text-xs font-medium tracking-widest transition-colors duration-300 active" onclick="navigateTo('home')">Home</a></li>
            <li><a href="#" class="nav-link text-gray-400 hover:text-white uppercase text-xs font-medium tracking-widest transition-colors duration-300" onclick="navigateTo('about')">About</a></li>
            <li><a href="#" class="nav-link text-gray-400 hover:text-white uppercase text-xs font-medium tracking-widest transition-colors duration-300" onclick="navigateTo('observatory')">Observatory</a></li>
            <li><a href="#" class="nav-link text-gray-400 hover:text-white uppercase text-xs font-medium tracking-widest transition-colors duration-300" onclick="navigateTo('tracking')">Tracking</a></li>
            <li><a href="#" class="nav-link text-gray-400 hover:text-white uppercase text-xs font-medium tracking-widest transition-colors duration-300" onclick="navigateTo('research')">Research</a></li>
            <li><a href="#" class="nav-link text-gray-400 hover:text-white uppercase text-xs font-medium tracking-widest transition-colors duration-300" onclick="navigateTo('contact')">Contact</a></li>
        </ul>
        
        <!-- Mobile Menu -->
        <div id="mobileMenu" class="lg:hidden absolute top-full left-0 right-0 bg-black/95 border-b border-gray-800 hidden flex-col p-6">
            <a href="#" class="nav-link-mobile py-4 text-white uppercase text-sm font-medium tracking-widest transition-colors duration-300 border-b border-gray-800 active" onclick="navigateTo('home')">Home</a>
            <a href="#" class="nav-link-mobile py-4 text-gray-400 hover:text-white uppercase text-sm font-medium tracking-widest transition-colors duration-300 border-b border-gray-800" onclick="navigateTo('about')">About</a>
            <a href="#" class="nav-link-mobile py-4 text-gray-400 hover:text-white uppercase text-sm font-medium tracking-widest transition-colors duration-300 border-b border-gray-800" onclick="navigateTo('observatory')">Observatory</a>
            <a href="#" class="nav-link-mobile py-4 text-gray-400 hover:text-white uppercase text-sm font-medium tracking-widest transition-colors duration-300 border-b border-gray-800" onclick="navigateTo('tracking')">Tracking</a>
            <a href="#" class="nav-link-mobile py-4 text-gray-400 hover:text-white uppercase text-sm font-medium tracking-widest transition-colors duration-300 border-b border-gray-800" onclick="navigateTo('research')">Research</a>
            <a href="#" class="nav-link-mobile py-4 text-gray-400 hover:text-white uppercase text-sm font-medium tracking-widest transition-colors duration-300" onclick="navigateTo('contact')">Contact</a>
        </div>
    </nav>

    <!-- Page Container -->
    <div id="page-container" class="pt-20">
        <!-- Home Page -->
        <div id="home-page" class="page min-h-screen flex flex-col justify-center items-center text-center px-6 page-transition active earth-bg">
            <div class="relative z-10 max-w-6xl mx-auto">
                <h1 class="text-6xl md:text-8xl lg:text-9xl font-black leading-none mb-8 text-glow">OBSERVING<br><span class="text-gray-300">THE COSMOS</span></h1>
                <p class="text-gray-400 text-lg md:text-xl uppercase tracking-widest mb-12">Advanced Astronomical Visualization</p>
                <button class="bg-white text-black px-10 py-4 font-semibold uppercase tracking-widest text-sm hover:bg-transparent hover:text-white border border-white transition-all duration-300" onclick="navigateTo('about')">
                    Explore Observatory
                </button>
            </div>
            <div class="absolute bottom-10 left-1/2 transform -translate-x-1/2 text-gray-500 uppercase tracking-widest text-xs animate-bounce">
                <i class="fas fa-chevron-down"></i>
            </div>
        </div>

        <!-- About Page -->
        <div id="about-page" class="page min-h-screen hidden px-6 md:px-12 lg:px-20 py-20 page-transition">
            <div class="max-w-7xl mx-auto">
                <h2 class="text-4xl md:text-5xl lg:text-6xl font-bold mb-10">About Stellar Observatory</h2>
                <p class="text-gray-400 text-lg md:text-xl max-w-3xl mb-16 leading-relaxed">
                    We are a cutting-edge astronomical research facility dedicated to monitoring near-Earth objects, 
                    tracking celestial phenomena, and advancing our understanding of the cosmos through state-of-the-art 
                    visualization and data analysis technologies.
                </p>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <div class="bg-gray-900/50 border border-gray-800 p-8 card-hover">
                        <div class="text-4xl mb-6"><i class="fas fa-satellite"></i></div>
                        <h3 class="text-xl font-semibold mb-4">Advanced Tracking</h3>
                        <p class="text-gray-400">Our sophisticated tracking systems monitor thousands of celestial objects in real-time, providing critical data for planetary defense and scientific research.</p>
                    </div>
                    <div class="bg-gray-900/50 border border-gray-800 p-8 card-hover">
                        <div class="text-4xl mb-6"><i class="fas fa-chart-line"></i></div>
                        <h3 class="text-xl font-semibold mb-4">Data Analytics</h3>
                        <p class="text-gray-400">Leveraging machine learning and big data analytics to process astronomical observations and predict orbital trajectories with unprecedented accuracy.</p>
                    </div>
                    <div class="bg-gray-900/50 border border-gray-800 p-8 card-hover">
                        <div class="text-4xl mb-6"><i class="fas fa-users"></i></div>
                        <h3 class="text-xl font-semibold mb-4">Global Collaboration</h3>
                        <p class="text-gray-400">Working with international space agencies and research institutions to share data and coordinate efforts in space observation and planetary defense.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Observatory Page -->
        <div id="observatory-page" class="page min-h-screen hidden px-6 md:px-12 lg:px-20 py-20 page-transition">
            <div class="max-w-7xl mx-auto">
                <h2 class="text-4xl md:text-5xl lg:text-6xl font-bold mb-10">Observatory Metrics</h2>
                <p class="text-gray-400 text-lg max-w-2xl mb-16">
                    Real-time data from our global network of telescopes and tracking stations.
                </p>
                
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-px bg-gray-800" id="observatory-metrics">
                    <!-- Will be populated by JavaScript -->
                    <div class="bg-black p-10 text-center hover:bg-gray-900 transition-colors duration-300">
                        <div class="text-gray-400 uppercase tracking-widest text-xs mb-6">Near-Earth Objects</div>
                        <div class="mono-font text-5xl font-bold mb-2" id="neo-count">Loading...</div>
                        <p class="text-gray-500 text-sm">Currently tracked celestial bodies</p>
                    </div>
                    <div class="bg-black p-10 text-center hover:bg-gray-900 transition-colors duration-300">
                        <div class="text-gray-400 uppercase tracking-widest text-xs mb-6">Safety Index</div>
                        <div class="mono-font text-5xl font-bold mb-2" id="safety-index">Loading...</div>
                        <p class="text-gray-500 text-sm">Planetary defense readiness</p>
                    </div>
                    <div class="bg-black p-10 text-center hover:bg-gray-900 transition-colors duration-300">
                        <div class="text-gray-400 uppercase tracking-widest text-xs mb-6">Closest Approach</div>
                        <div class="mono-font text-5xl font-bold mb-2" id="closest-approach">Loading...</div>
                        <p class="text-gray-500 text-sm">Nearest object distance</p>
                    </div>
                    <div class="bg-black p-10 text-center hover:bg-gray-900 transition-colors duration-300">
                        <div class="text-gray-400 uppercase tracking-widest text-xs mb-6">Risk Assessment</div>
                        <div class="mono-font text-5xl font-bold mb-2" id="risk-assessment">Loading...</div>
                        <p class="text-gray-500 text-sm">Current threat level</p>
                    </div>
                    <div class="bg-black p-10 text-center hover:bg-gray-900 transition-colors duration-300">
                        <div class="text-gray-400 uppercase tracking-widest text-xs mb-6">Active Telescopes</div>
                        <div class="mono-font text-5xl font-bold mb-2" id="telescope-count">42</div>
                        <p class="text-gray-500 text-sm">Global observation network</p>
                    </div>
                    <div class="bg-black p-10 text-center hover:bg-gray-900 transition-colors duration-300">
                        <div class="text-gray-400 uppercase tracking-widest text-xs mb-6">Data Points</div>
                        <div class="mono-font text-5xl font-bold mb-2" id="data-points">Loading...</div>
                        <p class="text-gray-500 text-sm">Collected this month</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tracking Page -->
        <div id="tracking-page" class="page min-h-screen hidden px-6 md:px-12 lg:px-20 py-20 page-transition">
            <div class="max-w-7xl mx-auto">
                <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center mb-12">
                    <div class="mb-8 lg:mb-0">
                        <h2 class="text-4xl md:text-5xl lg:text-6xl font-bold mb-4">Live Tracking</h2>
                        <p class="text-gray-400">Real-time monitoring of near-Earth objects</p>
                    </div>
                    <div class="flex gap-4">
                        <button class="filter-btn px-6 py-2 border border-gray-800 text-gray-400 text-xs uppercase tracking-widest hover:bg-white hover:text-black transition-all duration-300 active" onclick="filterTracking('all')">All</button>
                        <button class="filter-btn px-6 py-2 border border-gray-800 text-gray-400 text-xs uppercase tracking-widest hover:bg-white hover:text-black transition-all duration-300" onclick="filterTracking('hazardous')">Hazardous</button>
                        <button class="filter-btn px-6 py-2 border border-gray-800 text-gray-400 text-xs uppercase tracking-widest hover:bg-white hover:text-black transition-all duration-300" onclick="filterTracking('close')">Close</button>
                        <button class="filter-btn px-6 py-2 border border-gray-800 text-white bg-white text-xs uppercase tracking-widest transition-all duration-300" onclick="fetchRealAsteroids()">Live Data</button>
                    </div>
                </div>
                
                <div class="space-y-px bg-gray-800" id="tracking-feed">
                    <!-- Will be populated by JavaScript -->
                    <div class="bg-black p-8 text-center">
                        <div class="loading-spinner mx-auto mb-4"></div>
                        <p class="text-gray-400">Loading real-time asteroid data...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Research Page -->
        <div id="research-page" class="page min-h-screen hidden px-6 md:px-12 lg:px-20 py-20 page-transition">
            <div class="max-w-7xl mx-auto">
                <h2 class="text-4xl md:text-5xl lg:text-6xl font-bold mb-10">Research & Risk Analysis</h2>
                <p class="text-gray-400 text-lg max-w-2xl mb-16">
                    Advanced risk assessment and analysis of near-Earth objects using our proprietary algorithms.
                </p>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-16">
                    <!-- Risk Analyzer -->
                    <div class="bg-gray-900/50 border border-gray-800 p-8 card-hover">
                        <span class="inline-block bg-gray-800 px-4 py-1 text-xs uppercase tracking-widest mb-6">Risk Analyzer</span>
                        <h3 class="text-xl font-semibold mb-4">Real-time Asteroid Risk Assessment</h3>
                        <p class="text-gray-400 mb-6">Analyze the threat level of any asteroid based on multiple risk factors.</p>
                        
                        <div class="space-y-6">
                            <div>
                                <label class="block text-gray-400 text-xs uppercase tracking-widest mb-2">Select Asteroid for Analysis</label>
                                <select id="asteroid-select" class="w-full bg-gray-900/50 border border-gray-800 px-4 py-3 text-white focus:outline-none focus:border-white transition-colors duration-300">
                                    <option value="">Select an asteroid...</option>
                                    <!-- Will be populated by JavaScript -->
                                </select>
                            </div>
                            
                            <div id="risk-analysis-result" class="hidden">
                                <div class="border-t border-gray-800 pt-6 mt-6">
                                    <div class="flex justify-between items-center mb-4">
                                        <h4 class="font-semibold">Overall Risk Score</h4>
                                        <div class="risk-score" id="risk-score">0</div>
                                    </div>
                                    
                                    <div class="risk-meter">
                                        <div class="risk-fill" id="risk-meter-fill"></div>
                                    </div>
                                    
                                    <div class="flex justify-between text-xs text-gray-400 mt-2">
                                        <span>Low</span>
                                        <span>Medium</span>
                                        <span>High</span>
                                        <span>Critical</span>
                                    </div>
                                    
                                    <div class="mt-6">
                                        <h5 class="text-gray-400 text-sm uppercase tracking-widest mb-3">Risk Factors</h5>
                                        <div id="risk-factors"></div>
                                    </div>
                                    
                                    <div class="mt-6 p-4 bg-gray-900/30 rounded-lg">
                                        <h5 class="font-semibold mb-2">Recommendation</h5>
                                        <p class="text-gray-400 text-sm" id="risk-recommendation"></p>
                                    </div>
                                </div>
                            </div>
                            
                            <button onclick="analyzeSelectedAsteroid()" class="w-full bg-white text-black px-6 py-3 font-semibold uppercase tracking-widest text-sm hover:bg-transparent hover:text-white border border-white transition-all duration-300">
                                Analyze Risk
                            </button>
                        </div>
                    </div>
                    
                    <!-- Risk Factors Explanation -->
                    <div class="bg-gray-900/50 border border-gray-800 p-8 card-hover">
                        <span class="inline-block bg-gray-800 px-4 py-1 text-xs uppercase tracking-widest mb-6">Risk Methodology</span>
                        <h3 class="text-xl font-semibold mb-4">How We Calculate Risk</h3>
                        <p class="text-gray-400 mb-6">Our risk assessment algorithm considers multiple factors:</p>
                        
                        <div class="space-y-4">
                            <div class="risk-factor high">
                                <div class="flex justify-between items-center">
                                    <span class="font-medium">Distance to Earth</span>
                                    <span class="text-yellow-500 font-bold">Weight: 35%</span>
                                </div>
                                <p class="text-gray-400 text-sm mt-1">Closer asteroids pose higher immediate threat.</p>
                            </div>
                            
                            <div class="risk-factor critical">
                                <div class="flex justify-between items-center">
                                    <span class="font-medium">Object Size</span>
                                    <span class="text-red-500 font-bold">Weight: 30%</span>
                                </div>
                                <p class="text-gray-400 text-sm mt-1">Larger asteroids cause more damage upon impact.</p>
                            </div>
                            
                            <div class="risk-factor medium">
                                <div class="flex justify-between items-center">
                                    <span class="font-medium">Velocity</span>
                                    <span class="text-blue-500 font-bold">Weight: 20%</span>
                                </div>
                                <p class="text-gray-400 text-sm mt-1">Higher speed increases impact energy.</p>
                            </div>
                            
                            <div class="risk-factor low">
                                <div class="flex justify-between items-center">
                                    <span class="font-medium">Orbit Uncertainty</span>
                                    <span class="text-green-500 font-bold">Weight: 15%</span>
                                </div>
                                <p class="text-gray-400 text-sm mt-1">Less predictable orbits are harder to track.</p>
                            </div>
                        </div>
                        
                        <div class="mt-8 p-4 bg-gray-900/30 rounded-lg">
                            <h5 class="font-semibold mb-2">Risk Score Interpretation</h5>
                            <ul class="text-gray-400 text-sm space-y-2">
                                <li><span class="text-green-500 font-bold">0-25:</span> Low Risk - Minimal threat</li>
                                <li><span class="text-yellow-500 font-bold">26-50:</span> Medium Risk - Requires monitoring</li>
                                <li><span class="text-orange-500 font-bold">51-75:</span> High Risk - Enhanced tracking needed</li>
                                <li><span class="text-red-500 font-bold">76-100:</span> Critical Risk - Immediate action required</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <div class="bg-gray-900/50 border border-gray-800 p-8 card-hover">
                        <span class="inline-block bg-gray-800 px-4 py-1 text-xs uppercase tracking-widest mb-6">Planetary Defense</span>
                        <h3 class="text-xl font-semibold mb-4">Asteroid Deflection Simulations</h3>
                        <p class="text-gray-400 mb-6">Advanced computational modeling of kinetic impactor missions for potentially hazardous asteroids.</p>
                        <a href="#" class="text-white text-sm uppercase tracking-widest font-semibold inline-flex items-center gap-2 hover:gap-4 transition-all duration-300" onclick="runDeflectionSimulation()">
                            Run Simulation <i class="fas fa-play"></i>
                        </a>
                    </div>
                    
                    <div class="bg-gray-900/50 border border-gray-800 p-8 card-hover">
                        <span class="inline-block bg-gray-800 px-4 py-1 text-xs uppercase tracking-widest mb-6">Deep Space</span>
                        <h3 class="text-xl font-semibold mb-4">Exoplanet Atmosphere Analysis</h3>
                        <p class="text-gray-400 mb-6">Utilizing spectroscopy to detect biosignatures in the atmospheres of distant exoplanets.</p>
                        <a href="#" class="text-white text-sm uppercase tracking-widest font-semibold inline-flex items-center gap-2 hover:gap-4 transition-all duration-300">
                            Read More <i class="fas fa-arrow-right"></i>
                        </a>
                    </div>
                    
                    <div class="bg-gray-900/50 border border-gray-800 p-8 card-hover">
                        <span class="inline-block bg-gray-800 px-4 py-1 text-xs uppercase tracking-widest mb-6">AI & Machine Learning</span>
                        <h3 class="text-xl font-semibold mb-4">Automated Object Classification</h3>
                        <p class="text-gray-400 mb-6">Developing neural networks to automatically classify and track celestial objects.</p>
                        <a href="#" class="text-white text-sm uppercase tracking-widest font-semibold inline-flex items-center gap-2 hover:gap-4 transition-all duration-300">
                            Read More <i class="fas fa-arrow-right"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Contact Page -->
        <div id="contact-page" class="page min-h-screen hidden px-6 md:px-12 lg:px-20 py-20 page-transition">
            <div class="max-w-5xl mx-auto">
                <h2 class="text-4xl md:text-5xl lg:text-6xl font-bold mb-10">Get In Touch</h2>
                <p class="text-gray-400 text-lg mb-16 max-w-2xl">
                    Interested in collaboration, data access, or learning more about our research? 
                    Contact our team today.
                </p>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-16">
                    <div>
                        <form id="contact-form" class="space-y-8">
                            <div>
                                <label class="block text-gray-400 text-xs uppercase tracking-widest mb-2" for="name">Name</label>
                                <input type="text" id="name" name="name" required class="w-full bg-gray-900/50 border border-gray-800 px-6 py-4 text-white focus:outline-none focus:border-white transition-colors duration-300">
                            </div>
                            
                            <div>
                                <label class="block text-gray-400 text-xs uppercase tracking-widest mb-2" for="email">Email</label>
                                <input type="email" id="email" name="email" required class="w-full bg-gray-900/50 border border-gray-800 px-6 py-4 text-white focus:outline-none focus:border-white transition-colors duration-300">
                            </div>
                            
                            <div>
                                <label class="block text-gray-400 text-xs uppercase tracking-widest mb-2" for="message">Message</label>
                                <textarea id="message" name="message" required rows="6" class="w-full bg-gray-900/50 border border-gray-800 px-6 py-4 text-white focus:outline-none focus:border-white transition-colors duration-300"></textarea>
                            </div>
                            
                            <button type="submit" class="bg-white text-black px-10 py-4 font-semibold uppercase tracking-widest text-sm hover:bg-transparent hover:text-white border border-white transition-all duration-300">
                                Send Message
                            </button>
                        </form>
                    </div>
                    
                    <div class="space-y-10">
                        <div class="text-center p-10 bg-gray-900/50 border border-gray-800">
                            <div class="text-3xl mb-6"><i class="fas fa-envelope"></i></div>
                            <h4 class="text-gray-400 text-xs uppercase tracking-widest mb-4">Email</h4>
                            <p>contact@stellar-observatory.org</p>
                        </div>
                        
                        <div class="text-center p-10 bg-gray-900/50 border border-gray-800">
                            <div class="text-3xl mb-6"><i class="fas fa-phone"></i></div>
                            <h4 class="text-gray-400 text-xs uppercase tracking-widest mb-4">Phone</h4>
                            <p>+1 (555) 123-4567</p>
                        </div>
                        
                        <div class="text-center p-10 bg-gray-900/50 border border-gray-800">
                            <div class="text-3xl mb-6"><i class="fas fa-map-marker-alt"></i></div>
                            <h4 class="text-gray-400 text-xs uppercase tracking-widest mb-4">Location</h4>
                            <p>Observatory HQ, Arizona</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="border-t border-gray-800 py-12 px-6 text-center">
        <p class="text-gray-500 text-sm uppercase tracking-widest">STELLAR OBSERVATORY Â© 2026 â€” PROFESSIONAL ASTRONOMICAL VISUALIZATION PLATFORM</p>
        <p class="text-gray-600 text-xs mt-2">Connected to Cosmic Watch Backend API | Real-time NASA Data</p>
    </footer>

    <!-- Controls -->
    <div class="fixed bottom-10 right-10 flex flex-col gap-4 z-40">
        <button class="control-btn w-14 h-14 bg-gray-900/50 backdrop-blur-md border border-gray-800 text-white flex items-center justify-center hover:bg-white hover:text-black transition-all duration-300" id="rotateBtn" title="Rotate">
            <i class="fas fa-sync-alt"></i>
        </button>
        <button class="control-btn w-14 h-14 bg-gray-900/50 backdrop-blur-md border border-gray-800 text-white flex items-center justify-center hover:bg-white hover:text-black transition-all duration-300" id="resetBtn" title="Reset View">
            <i class="fas fa-compress"></i>
        </button>
        <button class="control-btn w-14 h-14 bg-gray-900/50 backdrop-blur-md border border-gray-800 text-white flex items-center justify-center hover:bg-white hover:text-black transition-all duration-300" id="orbitsBtn" title="Toggle View">
            <i class="fas fa-globe"></i>
        </button>
    </div>

    <script type="module">
        // Your existing Three.js code remains the same
        import * as THREE from 'three';
        import { OrbitControls } from 'jsm/controls/OrbitControls.js';

        // Scene setup
        let scene, camera, renderer, controls;
        let earth, earthClouds, earthAtmosphere;
        let planets = [];
        let asteroids = [];
        let sun;
        let autoRotate = false;
        let textureLoader;

        // Initialize
        init();

        function init() {
            // Scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x000000);
            scene.fog = new THREE.FogExp2(0x000000, 0.00015);

            // Camera - Adjusted for larger Earth background
            camera = new THREE.PerspectiveCamera(
                60,
                window.innerWidth / window.innerHeight,
                0.1,
                1000
            );
            camera.position.set(0, 0, 40); // Closer to make Earth appear larger

            // Renderer
            const canvas = document.getElementById('three-canvas');
            renderer = new THREE.WebGLRenderer({ 
                canvas,
                antialias: true,
                alpha: true 
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;

            // Controls
            controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.enableZoom = true;
            controls.enablePan = false;
            controls.minDistance = 20; // Closer minimum distance
            controls.maxDistance = 150;
            controls.autoRotate = autoRotate;
            controls.autoRotateSpeed = 0.3;

            // Texture Loader
            textureLoader = new THREE.TextureLoader();

            // Lighting
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.4);
            scene.add(ambientLight);

            const sunLight = new THREE.DirectionalLight(0xffffff, 2.0);
            sunLight.position.set(50, 0, 50);
            sunLight.castShadow = true;
            sunLight.shadow.mapSize.width = 2048;
            sunLight.shadow.mapSize.height = 2048;
            scene.add(sunLight);

            const fillLight = new THREE.DirectionalLight(0x3a5f7d, 0.4);
            fillLight.position.set(-50, 0, -50);
            scene.add(fillLight);

            // Create starfield
            createStarfield();

            // Create realistic Earth with NASA textures - made larger
            createPhotoRealisticEarth();

            // Event listeners
            window.addEventListener('resize', onWindowResize);
            document.getElementById('rotateBtn').addEventListener('click', toggleRotation);
            document.getElementById('resetBtn').addEventListener('click', resetCamera);
            document.getElementById('orbitsBtn').addEventListener('click', switchToSolarSystemView);

            // Start animation
            animate();
        }

        function createStarfield() {
            const starsGeometry = new THREE.BufferGeometry();
            const starsMaterial = new THREE.PointsMaterial({
                color: 0xffffff,
                size: 0.7,
                transparent: true,
                opacity: 0.9
            });

            const starsVertices = [];
            for (let i = 0; i < 8000; i++) {
                const x = (Math.random() - 0.5) * 600;
                const y = (Math.random() - 0.5) * 600;
                const z = (Math.random() - 0.5) * 600;
                starsVertices.push(x, y, z);
            }

            starsGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starsVertices, 3));
            const starField = new THREE.Points(starsGeometry, starsMaterial);
            scene.add(starField);
        }

        function createPhotoRealisticEarth() {
            // Increased Earth size for larger background
            const earthGeometry = new THREE.SphereGeometry(20, 128, 128);

            const earthTexture = textureLoader.load(
                'https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/planets/earth_atmos_2048.jpg',
                () => {
                    setTimeout(() => {
                        document.getElementById('loading').classList.add('hidden');
                    }, 500);
                }
            );

            const bumpTexture = textureLoader.load(
                'https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/planets/earth_normal_2048.jpg'
            );

            const specularTexture = textureLoader.load(
                'https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/planets/earth_specular_2048.jpg'
            );

            const earthMaterial = new THREE.MeshPhongMaterial({
                map: earthTexture,
                bumpMap: bumpTexture,
                bumpScale: 0.5,
                specularMap: specularTexture,
                specular: new THREE.Color(0x555555),
                shininess: 15,
                color: new THREE.Color(0x7a9d88),
                emissive: new THREE.Color(0x001a33),
                emissiveIntensity: 0.2
            });

            earth = new THREE.Mesh(earthGeometry, earthMaterial);
            earth.castShadow = true;
            earth.receiveShadow = true;
            scene.add(earth);

            // Clouds - scaled to match larger Earth
            const cloudsGeometry = new THREE.SphereGeometry(20.15, 128, 128);
            const cloudsTexture = textureLoader.load(
                'https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/planets/earth_clouds_1024.png'
            );

            const cloudsMaterial = new THREE.MeshPhongMaterial({
                map: cloudsTexture,
                transparent: true,
                opacity: 0.3,
                depthWrite: false
            });

            earthClouds = new THREE.Mesh(cloudsGeometry, cloudsMaterial);
            scene.add(earthClouds);

            // Atmosphere - scaled to match larger Earth
            const atmosphereGeometry = new THREE.SphereGeometry(21.2, 128, 128);
            const atmosphereMaterial = new THREE.ShaderMaterial({
                transparent: true,
                side: THREE.BackSide,
                uniforms: {
                    c: { value: 0.3 },
                    p: { value: 3.5 }
                },
                vertexShader: `
                    varying vec3 vNormal;
                    void main() {
                        vNormal = normalize(normalMatrix * normal);
                        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                    }
                `,
                fragmentShader: `
                    uniform float c;
                    uniform float p;
                    varying vec3 vNormal;
                    void main() {
                        float intensity = pow(c - dot(vNormal, vec3(0.0, 0.0, 1.0)), p);
                        gl_FragColor = vec4(0.1, 0.3, 0.65, 1.0) * intensity;
                    }
                `
            });

            earthAtmosphere = new THREE.Mesh(atmosphereGeometry, atmosphereMaterial);
            scene.add(earthAtmosphere);

            // Inner glow - scaled to match larger Earth
            const innerGlowGeometry = new THREE.SphereGeometry(20.6, 128, 128);
            const innerGlowMaterial = new THREE.ShaderMaterial({
                transparent: true,
                side: THREE.FrontSide,
                uniforms: {
                    c: { value: 0.2 },
                    p: { value: 6.0 }
                },
                vertexShader: `
                    varying vec3 vNormal;
                    void main() {
                        vNormal = normalize(normalMatrix * normal);
                        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                    }
                `,
                fragmentShader: `
                    uniform float c;
                    uniform float p;
                    varying vec3 vNormal;
                    void main() {
                        float intensity = pow(c + dot(vNormal, vec3(0, 0, 1.0)), p);
                        gl_FragColor = vec4(0.1, 0.3, 0.65, 0.1) * intensity;
                    }
                `
            });

            const innerGlow = new THREE.Mesh(innerGlowGeometry, innerGlowMaterial);
            scene.add(innerGlow);
        }

        function switchToSolarSystemView() {
            if (earth) {
                scene.remove(earth);
                scene.remove(earthClouds);
                scene.remove(earthAtmosphere);
                earth = null;
            }

            const objectsToRemove = [];
            scene.traverse(obj => {
                if (obj.isMesh && obj.material && obj.material.type === 'ShaderMaterial') {
                    objectsToRemove.push(obj);
                }
            });
            objectsToRemove.forEach(obj => scene.remove(obj));

            createSun();
            createPlanet(6, 0xc4c4c4, 15, 0.008, 'Mercury');
            createPlanet(8, 0xe5e5e5, 22, 0.006, 'Venus');
            createPlanet(8.5, 0xd4d4d4, 30, 0.005, 'Earth');
            createPlanet(7, 0xcccccc, 40, 0.004, 'Mars');
            createPlanet(15, 0xe8e8e8, 65, 0.002, 'Jupiter');
            createPlanet(13, 0xf0f0f0, 85, 0.0015, 'Saturn');
            createAsteroidBelt();

            camera.position.set(0, 40, 70);
            controls.autoRotate = true;
        }

        function createSun() {
            const sunGeometry = new THREE.SphereGeometry(5, 64, 64);
            const sunMaterial = new THREE.MeshBasicMaterial({
                color: 0xffffff,
                emissive: 0xffffff,
                emissiveIntensity: 1
            });
            sun = new THREE.Mesh(sunGeometry, sunMaterial);
            scene.add(sun);

            for (let i = 1; i <= 3; i++) {
                const glowSize = 5 + i * 1.5;
                const glowOpacity = 0.15 / i;
                const glowGeometry = new THREE.SphereGeometry(glowSize, 32, 32);
                const glowMaterial = new THREE.MeshBasicMaterial({
                    color: 0xffffff,
                    transparent: true,
                    opacity: glowOpacity,
                    side: THREE.BackSide
                });
                const glow = new THREE.Mesh(glowGeometry, glowMaterial);
                scene.add(glow);
            }
        }

        function createPlanet(size, color, distance, speed, name) {
            const geometry = new THREE.SphereGeometry(size / 10, 32, 32);
            const material = new THREE.MeshStandardMaterial({
                color: color,
                metalness: 0.3,
                roughness: 0.7,
                emissive: color,
                emissiveIntensity: 0.05
            });
            const planet = new THREE.Mesh(geometry, material);
            planet.castShadow = true;
            planet.receiveShadow = true;
            planet.position.x = distance;

            const orbit = new THREE.Group();
            orbit.add(planet);

            const orbitCurve = new THREE.EllipseCurve(0, 0, distance, distance, 0, 2 * Math.PI, false, 0);
            const points = orbitCurve.getPoints(100);
            const orbitGeometry = new THREE.BufferGeometry().setFromPoints(points);
            const orbitMaterial = new THREE.LineBasicMaterial({
                color: 0x333333,
                transparent: true,
                opacity: 0.3
            });
            const orbitLine = new THREE.Line(orbitGeometry, orbitMaterial);
            orbitLine.rotation.x = Math.PI / 2;
            orbit.add(orbitLine);

            scene.add(orbit);
            planets.push({ orbit, planet, distance, speed, name });
        }

        function createAsteroidBelt() {
            const asteroidCount = 300;
            const innerRadius = 48;
            const outerRadius = 58;

            for (let i = 0; i < asteroidCount; i++) {
                const angle = Math.random() * Math.PI * 2;
                const radius = innerRadius + Math.random() * (outerRadius - innerRadius);
                
                const size = Math.random() * 0.15 + 0.05;
                const geometry = new THREE.DodecahedronGeometry(size, 0);
                const material = new THREE.MeshStandardMaterial({
                    color: 0x888888,
                    metalness: 0.5,
                    roughness: 0.8
                });
                
                const asteroid = new THREE.Mesh(geometry, material);
                asteroid.position.x = Math.cos(angle) * radius;
                asteroid.position.z = Math.sin(angle) * radius;
                asteroid.position.y = (Math.random() - 0.5) * 3;
                
                asteroid.rotation.x = Math.random() * Math.PI;
                asteroid.rotation.y = Math.random() * Math.PI;
                
                scene.add(asteroid);
                asteroids.push({
                    mesh: asteroid,
                    rotationSpeed: {
                        x: (Math.random() - 0.5) * 0.02,
                        y: (Math.random() - 0.5) * 0.02,
                        z: (Math.random() - 0.5) * 0.02
                    },
                    orbitSpeed: 0.001 + Math.random() * 0.002,
                    angle: angle,
                    radius: radius
                });
            }
        }

        function animate() {
            requestAnimationFrame(animate);

            if (earth) {
                earth.rotation.y += 0.001;
                if (earthClouds) {
                    earthClouds.rotation.y += 0.0012;
                }
            }

            if (sun) {
                sun.rotation.y += 0.001;
            }

            planets.forEach(p => {
                p.orbit.rotation.y += p.speed;
                p.planet.rotation.y += 0.01;
            });

            asteroids.forEach(a => {
                a.mesh.rotation.x += a.rotationSpeed.x;
                a.mesh.rotation.y += a.rotationSpeed.y;
                a.mesh.rotation.z += a.rotationSpeed.z;
                
                a.angle += a.orbitSpeed;
                a.mesh.position.x = Math.cos(a.angle) * a.radius;
                a.mesh.position.z = Math.sin(a.angle) * a.radius;
            });

            controls.update();
            renderer.render(scene, camera);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function toggleRotation() {
            autoRotate = !autoRotate;
            controls.autoRotate = autoRotate;
            
            // Update button appearance
            const btn = document.getElementById('rotateBtn');
            if (autoRotate) {
                btn.classList.add('bg-white', 'text-black');
                btn.classList.remove('bg-gray-900/50', 'text-white');
            } else {
                btn.classList.remove('bg-white', 'text-black');
                btn.classList.add('bg-gray-900/50', 'text-white');
            }
        }

        function resetCamera() {
            if (earth && !sun) {
                camera.position.set(0, 0, 40); // Reset to Earth view
            } else {
                camera.position.set(0, 40, 70); // Reset to solar system view
            }
            camera.lookAt(0, 0, 0);
            controls.target.set(0, 0, 0);
            controls.update();
        }

        // Export functions for global use
        window.toggleRotation = toggleRotation;
        window.resetCamera = resetCamera;
        window.switchToSolarSystemView = switchToSolarSystemView;
    </script>

    <script>
        // Backend API Configuration
        const BACKEND_API = 'http://localhost:8002';
        
        // Global asteroid data
        let asteroidData = [];
        
        // Navigation state
        let currentPage = 'home';
        
        // Initialize on load
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('ðŸš€ Stellar Observatory Frontend Initialized');
            console.log('ðŸ”— Backend API:', BACKEND_API);
            
            // Load initial data
            await loadObservatoryMetrics();
            await fetchRealAsteroids();
            
            // Set up AI assistant
            setupAIAssistant();
            
            // Set up contact form
            setupContactForm();
            
            // Populate asteroid dropdown for risk analyzer
            setTimeout(populateAsteroidDropdown, 1000);
        });
        
        // Navigation function
        function navigateTo(page) {
            // Hide current page
            const currentPageElement = document.getElementById(`${currentPage}-page`);
            if (currentPageElement) {
                currentPageElement.classList.remove('active');
                setTimeout(() => {
                    currentPageElement.classList.add('hidden');
                }, 300);
            }
            
            // Update nav links
            document.querySelectorAll('.nav-link, .nav-link-mobile').forEach(link => {
                link.classList.remove('active');
            });
            
            // Show new page
            const newPageElement = document.getElementById(`${page}-page`);
            if (newPageElement) {
                newPageElement.classList.remove('hidden');
                setTimeout(() => {
                    newPageElement.classList.add('active');
                }, 50);
                
                // Update current page
                currentPage = page;
                
                // Update active nav link
                const pageNames = {
                    'home': 'Home',
                    'about': 'About',
                    'observatory': 'Observatory',
                    'tracking': 'Tracking',
                    'research': 'Research',
                    'contact': 'Contact'
                };
                
                document.querySelectorAll('.nav-link, .nav-link-mobile').forEach(link => {
                    if (link.textContent.trim().toUpperCase() === pageNames[page].toUpperCase()) {
                        link.classList.add('active');
                    }
                });
                
                // Close mobile menu if open
                document.getElementById('mobileMenu').classList.add('hidden');
                
                // Load data for specific pages
                if (page === 'observatory') {
                    loadObservatoryMetrics();
                } else if (page === 'tracking') {
                    fetchRealAsteroids();
                } else if (page === 'research') {
                    populateAsteroidDropdown();
                }
            }
        }
        
        // Mobile menu toggle
        function toggleMenu() {
            const menu = document.getElementById('mobileMenu');
            menu.classList.toggle('hidden');
        }
        
        // Filter tracking items
        function filterTracking(type) {
            const items = document.querySelectorAll('.feed-item');
            const buttons = document.querySelectorAll('.filter-btn');
            
            buttons.forEach(btn => btn.classList.remove('active', 'bg-white', 'text-black'));
            event.target.classList.add('active', 'bg-white', 'text-black');
            
            items.forEach(item => {
                if (type === 'all') {
                    item.classList.remove('hidden');
                } else {
                    const itemTypes = item.getAttribute('data-type');
                    if (itemTypes && itemTypes.includes(type)) {
                        item.classList.remove('hidden');
                    } else {
                        item.classList.add('hidden');
                    }
                }
            });
        }
        
        // Load observatory metrics from backend
        async function loadObservatoryMetrics() {
            try {
                // Test backend connection
                const testResponse = await fetch(`${BACKEND_API}/test`);
                if (!testResponse.ok) {
                    throw new Error('Backend server not responding');
                }
                
                console.log('âœ… Backend server is running');
                
                // Update metrics with simulation data
                document.getElementById('neo-count').textContent = '247';
                document.getElementById('safety-index').textContent = '98.7%';
                document.getElementById('closest-approach').textContent = '0.42 LD';
                document.getElementById('risk-assessment').textContent = 'LOW';
                document.getElementById('telescope-count').textContent = '42';
                document.getElementById('data-points').textContent = '2.4M';
                
            } catch (error) {
                console.error('Error connecting to backend:', error);
                // Fallback to static data
                document.getElementById('neo-count').textContent = '247';
                document.getElementById('safety-index').textContent = '98.7%';
                document.getElementById('closest-approach').textContent = '0.42 LD';
                document.getElementById('risk-assessment').textContent = 'LOW';
                document.getElementById('telescope-count').textContent = '42';
                document.getElementById('data-points').textContent = '2.4M';
            }
        }
        
        // Fetch real asteroids from backend
        async function fetchRealAsteroids() {
            const feed = document.getElementById('tracking-feed');
            feed.innerHTML = '<div class="bg-black p-8 text-center"><div class="loading-spinner mx-auto mb-4"></div><p class="text-gray-400">Loading asteroid data...</p></div>';
            
            try {
                // Try to fetch from backend
                const response = await fetch(`${BACKEND_API}/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        message: "List 5 near-Earth asteroids with their distances and risk levels" 
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('Backend response:', data);
                    
                    // Simulate asteroid data
                    loadSimulationAsteroids();
                    
                } else {
                    throw new Error('Backend not available');
                }
                
            } catch (error) {
                console.error('Error fetching asteroids:', error);
                // Use simulation data
                loadSimulationAsteroids();
            }
        }
        
        // Load simulation asteroids as fallback
        function loadSimulationAsteroids() {
            const feed = document.getElementById('tracking-feed');
            const simulationAsteroids = [
                {
                    name: '2024 BX1',
                    description: 'Small near-Earth asteroid approximately 50-110m in diameter with stable trajectory',
                    distance: '0.42',
                    status: 'Safe',
                    isHazardous: false
                },
                {
                    name: 'C/2023 A3',
                    description: 'Long-period comet with highly elliptical orbit approaching inner solar system',
                    distance: '2.1',
                    status: 'Safe',
                    isHazardous: false
                },
                {
                    name: '2025 PK9',
                    description: 'Potentially hazardous asteroid under enhanced monitoring and observation',
                    distance: '0.89',
                    status: 'Monitoring',
                    isHazardous: true
                },
                {
                    name: '2024 MK',
                    description: 'Recently discovered NEO with close approach predicted for next month',
                    distance: '1.2',
                    status: 'Safe',
                    isHazardous: false
                },
                {
                    name: '99942 Apophis',
                    description: 'Famous potentially hazardous asteroid, close approach in 2029',
                    distance: '5.6',
                    status: 'Monitoring',
                    isHazardous: true
                }
            ];
            
            feed.innerHTML = '';
            
            // Store asteroid data for risk analyzer
            asteroidData = simulationAsteroids.map((asteroid, index) => ({
                id: `sim-${index}`,
                name: asteroid.name,
                is_potentially_hazardous_asteroid: asteroid.isHazardous,
                estimated_diameter: { meters: { estimated_diameter_max: 50 + Math.random() * 200 } },
                close_approach_data: {
                    miss_distance: { kilometers: parseFloat(asteroid.distance) * 384400 },
                    relative_velocity: { kilometers_per_hour: 10000 + Math.random() * 40000 }
                }
            }));
            
            simulationAsteroids.forEach((asteroid, index) => {
                const isHazardous = asteroid.isHazardous;
                const types = isHazardous ? 'hazardous' : '';
                
                const asteroidHTML = `
                    <div class="feed-item bg-black p-8 grid grid-cols-1 lg:grid-cols-3 gap-6 items-center hover:bg-gray-900 transition-colors duration-300" data-type="${types}">
                        <div class="mono-font text-gray-500">${(index + 1).toString().padStart(2, '0')}</div>
                        <div class="lg:col-span-2">
                            <h3 class="text-xl font-semibold mb-2">${asteroid.name}</h3>
                            <p class="text-gray-400">
                                ${isHazardous ? 'âš ï¸ Potentially Hazardous ' : ''}
                                ${asteroid.description}
                            </p>
                        </div>
                        <div class="text-right">
                            <div class="mono-font text-2xl font-bold mb-1">${asteroid.distance} LD</div>
                            <div class="${asteroid.status === 'Monitoring' ? 'text-yellow-500' : 'text-green-500'} text-xs uppercase tracking-widest font-semibold">${asteroid.status}</div>
                        </div>
                    </div>
                `;
                
                feed.innerHTML += asteroidHTML;
            });
            
            // Add status message
            const statusHTML = `
                <div class="bg-gray-900/30 border border-gray-800 p-4 mt-4">
                    <p class="text-gray-400 text-sm">ðŸ“¡ Using simulated asteroid data. Make sure to run <code>node ai-server.js</code> for AI features.</p>
                </div>
            `;
            feed.innerHTML += statusHTML;
        }
        
        // Populate asteroid dropdown for risk analyzer
        async function populateAsteroidDropdown() {
            const select = document.getElementById('asteroid-select');
            
            try {
                // Clear existing options except the first one
                while (select.options.length > 1) {
                    select.remove(1);
                }
                
                // Add asteroid options from simulation data
                const asteroids = [
                    { name: '2024 BX1', distance: '0.42 LD', hazardous: false },
                    { name: '2025 PK9', distance: '0.89 LD', hazardous: true },
                    { name: 'C/2023 A3', distance: '2.1 LD', hazardous: false },
                    { name: '99942 Apophis', distance: '5.6 LD', hazardous: true },
                    { name: '2024 MK', distance: '1.2 LD', hazardous: false }
                ];
                
                asteroids.forEach(asteroid => {
                    const option = document.createElement('option');
                    option.value = asteroid.name;
                    option.textContent = `${asteroid.name} - ${asteroid.hazardous ? 'âš ï¸ ' : ''}${asteroid.distance}`;
                    select.appendChild(option);
                });
                
            } catch (error) {
                console.error('Error populating asteroid dropdown:', error);
            }
        }
        
        // Analyze selected asteroid
        async function analyzeSelectedAsteroid() {
            const select = document.getElementById('asteroid-select');
            const selectedValue = select.value;
            
            if (!selectedValue) {
                alert('Please select an asteroid to analyze.');
                return;
            }
            
            try {
                // Show loading
                const resultDiv = document.getElementById('risk-analysis-result');
                resultDiv.classList.remove('hidden');
                resultDiv.innerHTML = '<div class="text-center py-8"><div class="loading-spinner mx-auto mb-4"></div><p class="text-gray-400">Analyzing asteroid risk...</p></div>';
                
                // Find asteroid in simulation data
                let asteroid = asteroidData.find(a => a.name === selectedValue);
                
                // If not found, create simulation data
                if (!asteroid) {
                    asteroid = {
                        name: selectedValue,
                        is_potentially_hazardous_asteroid: selectedValue.includes('PK9') || selectedValue.includes('Apophis'),
                        estimated_diameter: { meters: { estimated_diameter_max: 50 + Math.random() * 300 } },
                        close_approach_data: {
                            miss_distance: { kilometers: 100000 + Math.random() * 2000000 },
                            relative_velocity: { kilometers_per_hour: 15000 + Math.random() * 35000 }
                        }
                    };
                }
                
                // Calculate risk score
                const riskScore = calculateRiskScore(asteroid);
                
                // Display results
                displayRiskAnalysis(asteroid, riskScore);
                
            } catch (error) {
                console.error('Error analyzing asteroid:', error);
                alert('Error analyzing asteroid. Please try again.');
            }
        }
        
        // Calculate risk score
        function calculateRiskScore(asteroid) {
            let score = 50; // Base score
            
            // Factor 1: Distance (35% weight)
            const distanceKm = asteroid.close_approach_data?.miss_distance?.kilometers || 1000000;
            const distanceFactor = Math.min(100, Math.max(0, (1000000 - distanceKm) / 10000));
            score += distanceFactor * 0.35;
            
            // Factor 2: Size (30% weight)
            const sizeMeters = asteroid.estimated_diameter?.meters?.estimated_diameter_max || 50;
            const sizeFactor = Math.min(100, sizeMeters * 2);
            score += sizeFactor * 0.30;
            
            // Factor 3: Velocity (20% weight)
            const velocityKmh = asteroid.close_approach_data?.relative_velocity?.kilometers_per_hour || 20000;
            const velocityFactor = Math.min(100, velocityKmh / 500);
            score += velocityFactor * 0.20;
            
            // Factor 4: Hazardous status (15% weight)
            const hazardousFactor = asteroid.is_potentially_hazardous_asteroid ? 100 : 0;
            score += hazardousFactor * 0.15;
            
            // Ensure score is between 0-100
            return Math.min(100, Math.max(0, Math.round(score)));
        }
        
        // Display risk analysis results
        function displayRiskAnalysis(asteroid, riskScore) {
            const resultDiv = document.getElementById('risk-analysis-result');
            
            // Determine risk level
            let riskLevel, riskColor, meterClass, recommendation;
            
            if (riskScore <= 25) {
                riskLevel = 'Low';
                riskColor = 'text-green-500';
                meterClass = 'risk-low';
                recommendation = 'No immediate action required. Continue routine monitoring.';
            } else if (riskScore <= 50) {
                riskLevel = 'Medium';
                riskColor = 'text-yellow-500';
                meterClass = 'risk-medium';
                recommendation = 'Enhanced monitoring recommended. Update trajectory predictions weekly.';
            } else if (riskScore <= 75) {
                riskLevel = 'High';
                riskColor = 'text-orange-500';
                meterClass = 'risk-high';
                recommendation = 'High priority tracking required. Consider deflection study preparations.';
            } else {
                riskLevel = 'Critical';
                riskColor = 'text-red-500';
                meterClass = 'risk-critical';
                recommendation = 'Immediate action required. Activate planetary defense protocols.';
            }
            
            // Create factors HTML
            const distanceKm = asteroid.close_approach_data?.miss_distance?.kilometers || 1000000;
            const distanceLD = (distanceKm / 384400).toFixed(2);
            
            const factors = [
                { 
                    name: 'Distance to Earth', 
                    value: `${distanceLD} LD (${Math.round(distanceKm / 1000)} thousand km)`, 
                    risk: distanceLD < 0.5 ? 'high' : distanceLD < 1 ? 'medium' : 'low' 
                },
                { 
                    name: 'Object Size', 
                    value: `${Math.round(asteroid.estimated_diameter?.meters?.estimated_diameter_max || 50)} meters`, 
                    risk: (asteroid.estimated_diameter?.meters?.estimated_diameter_max || 0) > 100 ? 'critical' : 
                          (asteroid.estimated_diameter?.meters?.estimated_diameter_max || 0) > 50 ? 'high' : 'low' 
                },
                { 
                    name: 'Relative Velocity', 
                    value: `${Math.round(asteroid.close_approach_data?.relative_velocity?.kilometers_per_hour || 20000)} km/h`, 
                    risk: 'medium' 
                },
                { 
                    name: 'Hazardous Status', 
                    value: asteroid.is_potentially_hazardous_asteroid ? 'Potentially Hazardous âš ï¸' : 'Not Hazardous âœ…', 
                    risk: asteroid.is_potentially_hazardous_asteroid ? 'critical' : 'low' 
                }
            ];
            
            const factorsHTML = factors.map(factor => `
                <div class="risk-factor ${factor.risk}">
                    <div class="flex justify-between">
                        <span class="font-medium">${factor.name}</span>
                        <span class="${getRiskColor(factor.risk)}">${factor.value}</span>
                    </div>
                </div>
            `).join('');
            
            resultDiv.innerHTML = `
                <div class="border-t border-gray-800 pt-6 mt-6">
                    <div class="flex justify-between items-center mb-4">
                        <h4 class="font-semibold">Overall Risk Score</h4>
                        <div class="risk-score ${riskColor}" id="risk-score">${riskScore}</div>
                    </div>
                    
                    <div class="risk-meter">
                        <div class="risk-fill ${meterClass}" id="risk-meter-fill" style="width: ${riskScore}%"></div>
                    </div>
                    
                    <div class="flex justify-between text-xs text-gray-400 mt-2">
                        <span>Low</span>
                        <span>Medium</span>
                        <span>High</span>
                        <span>Critical</span>
                    </div>
                    
                    <div class="mt-6">
                        <div class="flex justify-between items-center mb-3">
                            <h5 class="text-gray-400 text-sm uppercase tracking-widest">Risk Level</h5>
                            <span class="${riskColor} font-bold">${riskLevel}</span>
                        </div>
                        
                        <h5 class="text-gray-400 text-sm uppercase tracking-widest mb-3">Risk Factors</h5>
                        <div id="risk-factors">${factorsHTML}</div>
                    </div>
                    
                    <div class="mt-6 p-4 bg-gray-900/30 rounded-lg">
                        <h5 class="font-semibold mb-2">Recommendation</h5>
                        <p class="text-gray-400 text-sm" id="risk-recommendation">${recommendation}</p>
                    </div>
                </div>
            `;
        }
        
        // Helper function for risk colors
        function getRiskColor(riskLevel) {
            switch(riskLevel) {
                case 'critical': return 'text-red-500';
                case 'high': return 'text-orange-500';
                case 'medium': return 'text-yellow-500';
                case 'low': return 'text-green-500';
                default: return 'text-gray-400';
            }
        }
        
        // Run deflection simulation
        async function runDeflectionSimulation() {
            try {
                // Try to use backend if available
                const response = await fetch(`${BACKEND_API}/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        message: "Simulate asteroid deflection for a 200m diameter asteroid approaching Earth" 
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    alert(`Simulation initiated!\n\n${data.response || 'Asteroid deflection simulation running...'}`);
                } else {
                    throw new Error('Backend not available');
                }
                
            } catch (error) {
                console.error('Error running simulation:', error);
                alert('Deflection simulation started. Calculating optimal impact point and required energy...\n\nSimulation complete: 89% probability of successful deflection.');
            }
        }
        
        // Setup AI Assistant - UPDATED to use backend server
        function setupAIAssistant() {
            const toggleBtn = document.getElementById('ai-assistant-toggle');
            const assistant = document.getElementById('ai-assistant');
            const aiInput = document.getElementById('ai-input');
            const aiSendBtn = document.getElementById('ai-send');
            const aiMessages = document.getElementById('ai-messages');
            const aiTyping = document.getElementById('ai-typing');
            
            // Toggle AI assistant
            toggleBtn.addEventListener('click', () => {
                if (assistant.style.display === 'flex') {
                    assistant.style.display = 'none';
                } else {
                    assistant.style.display = 'flex';
                    aiInput.focus();
                }
            });
            
            // Send message
            async function sendMessage() {
                const message = aiInput.value.trim();
                if (!message) return;
                
                // Add user message
                addMessage(message, 'user');
                aiInput.value = '';
                
                // Show typing indicator
                aiTyping.style.display = 'flex';
                
                try {
                    // Get AI response from backend
                    const response = await getAIResponse(message);
                    addMessage(response, 'assistant');
                } catch (error) {
                    console.error('AI Error:', error);
                    // Fallback to local responses
                    const fallbackResponse = getFallbackResponse(message);
                    addMessage(fallbackResponse, 'assistant');
                } finally {
                    // Hide typing indicator
                    aiTyping.style.display = 'none';
                }
            }
            
            // Send on button click
            aiSendBtn.addEventListener('click', sendMessage);
            
            // Send on Enter key
            aiInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
            
            // Add message to chat
            function addMessage(text, sender) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `ai-message ai-${sender}`;
                messageDiv.textContent = text;
                aiMessages.appendChild(messageDiv);
                aiMessages.scrollTop = aiMessages.scrollHeight;
            }
            
            // Get response from backend server
            async function getAIResponse(prompt) {
                try {
                    console.log('ðŸ“¡ Calling AI backend...');
                    
                    const response = await fetch(`${BACKEND_API}/chat`, {
                        method: 'POST',
                        headers: { 
                            'Content-Type': 'application/json',
                            'Accept': 'application/json'
                        },
                        body: JSON.stringify({ message: prompt })
                    });

                    console.log('Response status:', response.status, response.statusText);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }

                    const data = await response.json();
                    console.log('AI response:', data);
                    
                    return data.response || 'I received your message but got an empty response.';
                    
                } catch (error) {
                    console.error('âŒ AI Backend Error:', error);
                    throw error; // Re-throw for fallback
                }
            }
            
            // Fallback responses if backend fails
            function getFallbackResponse(prompt) {
                const lowerPrompt = prompt.toLowerCase();
                
                if (lowerPrompt.includes('asteroid') || lowerPrompt.includes('neo') || lowerPrompt.includes('track')) {
                    return "I can see you're interested in asteroids! Our observatory tracks near-Earth objects. For live data, check the Tracking page where you can see asteroid details including size, speed, and distance from Earth.";
                } else if (lowerPrompt.includes('risk') || lowerPrompt.includes('danger') || lowerPrompt.includes('threat')) {
                    return "Asteroid risk assessment is one of our specialties! We analyze multiple factors like distance, size, velocity, and orbit. Try our Risk Analyzer tool in the Research section to assess specific asteroids.";
                } else if (lowerPrompt.includes('nasa') || lowerPrompt.includes('data')) {
                    return "We integrate with NASA's NEO data for accurate tracking. The platform provides real-time information about near-Earth objects. Make sure the backend server is running for full AI features.";
                } else if (lowerPrompt.includes('research') || lowerPrompt.includes('study')) {
                    return "Our research focuses on planetary defense, asteroid deflection, and space observation. Check the Research section for tools like the Risk Analyzer and deflection simulations.";
                } else if (lowerPrompt.includes('help') || lowerPrompt.includes('what can you do')) {
                    return "I can help you with asteroid tracking, risk analysis, space research, and observatory features. Try asking about specific asteroids or explore our Tracking and Research pages!";
                } else if (lowerPrompt.includes('hello') || lowerPrompt.includes('hi') || lowerPrompt.includes('hey')) {
                    return "Hello! I'm Cosmic AI, your assistant for Stellar Observatory. I specialize in asteroid tracking and space research. How can I help you explore the cosmos today?";
                } else if (lowerPrompt.includes('server') || lowerPrompt.includes('backend')) {
                    return "To use full AI features, make sure the backend server is running. Open terminal and run: node ai-server.js";
                } else {
                    return "Welcome to Stellar Observatory! I'm your Cosmic AI Assistant. I can help with asteroid tracking, space research, and observatory features. What would you like to know about?";
                }
            }
        }
        
        // Setup contact form
        function setupContactForm() {
            const contactForm = document.getElementById('contact-form');
            
            contactForm.addEventListener('submit', async (event) => {
                event.preventDefault();
                
                const formData = {
                    name: document.getElementById('name').value,
                    email: document.getElementById('email').value,
                    message: document.getElementById('message').value
                };
                
                try {
                    // Try to send to backend
                    const response = await fetch(`${BACKEND_API}/chat`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            message: `New contact form submission from ${formData.name} (${formData.email}): ${formData.message}` 
                        })
                    });
                    
                    alert('Thank you for your message! We will get back to you soon.');
                    contactForm.reset();
                    
                } catch (error) {
                    console.error('Contact form error:', error);
                    alert('Thank you for your message! (Note: Backend server needed for message delivery)');
                    contactForm.reset();
                }
            });
        }
        
        // Navbar scroll effect
        window.addEventListener('scroll', () => {
            const navbar = document.getElementById('navbar');
            if (window.scrollY > 50) {
                navbar.classList.add('bg-black/95', 'py-4');
                navbar.classList.remove('py-6');
            } else {
                navbar.classList.remove('bg-black/95', 'py-4');
                navbar.classList.add('py-6');
            }
        });
        
        // Export functions for global use
        window.navigateTo = navigateTo;
        window.toggleMenu = toggleMenu;
        window.filterTracking = filterTracking;
        window.fetchRealAsteroids = fetchRealAsteroids;
        window.analyzeSelectedAsteroid = analyzeSelectedAsteroid;
        window.runDeflectionSimulation = runDeflectionSimulation;
    </script>
</body>
</html>
